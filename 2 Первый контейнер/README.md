# Первый контейнер

При прохождении теста были выполнены команды:
```
docker pull kcoursedocker/task-1.1
```

```
run --rm kcoursedocker/task-1.1
```

Если ошибка при работе с контейнером в Windows, то тогда добавить ```winpty``` при запуске:
```
winpty docker run --rm -it ubuntu
```

## Как получить образ
Контейнеры создаются на основе образа. Как его получить?

1. ```docker pull <ОБРАЗ>``` - Скачать из репозитория (Docker Hub). Если явно не указать тег, то скачается версия latest. Есть версии с тегом alpine - в которых содержится только самое нужное.
2. На основе готового образа создать свой через Dockerfile
3. ```docker commit <КОНТЕЙНЕР>``` - Создать образ на основе контейнера (обратный путь 1)

### Команды 

1. ```docker images``` или ```docker image ls``` - посмотреть список образов
2. ```docker rmi <ОБРАЗ> [ОБРАЗ...]``` или ```docker image rm <ОБРАЗ> [ОБРАЗ...]``` - удалить образ(ы)
3. ```docker run --name <ИМЯ> <ОБРАЗ>``` - при создании присвоить имя контейнеру
4. ```docker run --rm <ОБРАЗ>``` - удалять образ после завершения его работы
5. ```docker ps -a``` или ```docker ps --all``` - вывести список всех контейнеров (в том числе завершенные)

## Практика
Скачаем образы node latest, 16, alpine и yandex/clickhouse-server
```
docker pull node
```

```
docker pull node:16
```
```
docker pull node:alpine
```
```
docker pull yandex/clickhouse-server
```

Удалим лишние:
```
docker rmi node:alpine
```

Запустим контейнер с нодой (в списке всех контейнеров ```docker ps -a``` можно увидеть, что контейнер отработал и завершился)
```
docker run node
```

Запустим контейнер кликхаус:
```
docker run yandex/clickhouse-server
```

Сразу можно увидеть, что докер перехватил управление терминалом. Свернем его, откроем второй терминал и выведем список активных контейнеров ```docker ps```. Видно, что этот контейнер активен и имеет имя kind_knuth. Завершим его:
```
docker stop kind_knuth
```

Контейнер остановился и мы получили контроль над первым терминалом

### Запустим контейнер и войдем в него
-i интерактивный режим 
-t подключаем терминал

```
docker run -it node
```

Теперь контейнер сразу не завершается. Выйти из контейнера можно через ```ctrl+C```.

Удалить контейнеры:
```
docker rm <ИМЯ>
```

Можно запустить остановленный контейнер:
```
docker start <ИМЯ>
```

### Вход в работающий контейнер
Это необходимо, чтобы посмотрел логи, добавить файл, изменить конфигурационные файлы и т.д.. При запуске нужно указать команду, которая будет выполнятся при входе в контейнер ```bash```, то есть зайдем в контейнер с использованием bash.
```
docker exec -it <ИМЯ>
```

## Частые приемые при работе с контейнерами
### Запуск контейнера в фоновом режиме
Запустим контейнер без перехвата управления терминалом, то есть в фоновом режиме:
```
docker run -d <ОБРАЗ>
```

Зададим имя контейнера при запуске:
```
docker run --name <ИМЯ>
```

Создадим контейнер, который будет удален при остановке
```
docker run --name <ИМЯ> --rm
```

## Остановим и удалим все контейнеры двумя командами
В баше есть конструкция вида ```$(Какая-нибудь команда)``` и команда в скобочках будет выполнена первой и результат ее выполнения будет передан другой команде, например:
```
echo $(pwd)
```

Как это поможет с докером? - Смотрим. 
```
docker stop $(docker ps -q)
```
```docker ps -q``` выведет нам id запущенных контейнеров, а ```docker stop``` остнановит их.

Аналогично с удалением:
```
docker rm $(docker ps -aq)
```

##Запустим докер с Ubuntu:
```
docker run -it --rm ubuntu
```

## Сохраним стейт (состояние) контейнера
Создадим папку и файл:
```
mkdir test
touch test/test.txt
echo 123 test/test.txt
cat test/test.txt
```

Сохраним стейт:
```
docker commit <ИМЯ> <НОВОЕ ИМЯ ОБРАЗА>:< СВОЙ ТЭГ>
```
Например:
```
docker commit <suspicious_torvalds> <new_ubuntu>:<1>
```

Проверим образы. Увидим наш. Теперь его можно запустить в интерактивном режиме и увидеть созданную папку и файл.

## Посмотреть слои образа
```
docker history
```

